name: Check Repositories for tomeroz802 Creations

on:
  schedule:
    - cron: '*/5 * * * *'  # Runs every 5 minutes
  workflow_dispatch:

jobs:
  check_repos:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v3

      - name: List all repositories
        env:
          GITHUB_TOKEN: ${{ secrets.AUTOMATIONTOKEN }}
        run: |
          curl -s -H "Authorization: token $GITHUB_TOKEN" \
          https://api.github.com/user/repos?per_page=100 \
          | jq -r '.[] | .name' > repo_list.txt

      - name: Check if tomeroz802 created the repo
        env:
          GITHUB_TOKEN: ${{ secrets.AUTOMATIONTOKEN }}
          tomeroz802_USERNAME: "tomeroz802"  # Your GitHub username
        run: |
          while read repo; do
            creator=$(curl -s -H "Authorization: token $GITHUB_TOKEN" \
              https://api.github.com/repos/YOUR_USERNAME/$repo \
              | jq -r '.owner.login')
              
            if [ "$creator" == "$tomeroz802_USERNAME" ]; then
              echo "tomeroz802 created $repo, adding tickets group"
              curl -s -H "Authorization: token $GITHUB_TOKEN" \
                -X PUT -d '{"permission":"push"}' \
                https://api.github.com/repos/YOUR_USERNAME/$repo/collaborators/tickets
            else
              echo "$repo was not created by tomeroz802"
            fi
          done < repo_list.txt
